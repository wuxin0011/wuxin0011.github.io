---
title: Ruoyi-Cloudé¡¹ç›®åŸºäºDockerçš„éƒ¨ç½²
date: 2023-2-20 15:22:20
permalink: /pages/dddcc34234fda
categories: 
  - æŠ€æœ¯
  - é¡¹ç›®éƒ¨ç½²
tags: 
  - ruoyi
author: 
  name: wuxin0011
  link: https://github.com/wuxin0011
---




### 1ã€ç¬¬ä¸€æ­¥æ‹‰å–ä»£ç 


```shell
git clone https://gitee.com/y_project/RuoYi-Cloud.git
```



### 2ã€æ‰“åŒ…å‰ç«¯é¡¹ç›®

* **å®‰è£…å‰æ£€æŸ¥** Node æ˜¯å¦å®‰è£…
*  æ³¨æ„ä¸è¦å®‰è£…ç‰ˆæœ¬å¤ªé«˜ï¼æœ€å¥½é€‰æ‹© 16.xç‰ˆæœ¬ , [ä¸‹è½½](https://nodejs.org/dist/latest-v16.x/)
* ä¸‹è½½ä¾èµ–
* æ‰“åŒ…


ä¸‹è½½Node

![](https://cdn.staticaly.com/gh/wuxin0011/blog-resource@main/picgo/download-node-16.png)


> **æ³¨æ„é…ç½®Nodeç¯å¢ƒå˜é‡ï¼Œé…ç½®å®Œæ¯•åï¼Œä¹‹å‰æ‰“å¼€çš„ cmd çª—å£è¦å…³é—­æ‰èƒ½ç”Ÿæ•ˆï¼**
>


**ä¸‹è½½ä¾èµ–** æ‰§è¡Œ `\ruoyi-ui\bin` ç›®å½•ä¸‹çš„è„šæœ¬

```shell
.\ruoyi-ui\bin\package.bat
```

**æ‰“åŒ…** `\ruoyi-ui\bin`ç›®å½•ä¸‹çš„è„šæœ¬

```shell
.\ruoyi-ui\bin\build.bat
```


### 3ã€åç«¯æœåŠ¡Javaæ¥å£æ‰“åŒ…

* ä¿®æ”¹ host åœ°å€
* æ‰§è¡Œ `bin` ç›®å½•ä¸‹çš„ `clean.bat`
* æ‰“åŒ…ï¼Œæ‰§è¡Œ `bin` ç›®å½•ä¸‹çš„ `package.bat`


ä¿®æ”¹ **host** åœ°å€ï¼Œå°† **host** åœ°å€ä¿®æ”¹ä¸ºå¯¹åº”åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²çš„ **æœåŠ¡å**


ä¾‹å¦‚ä¿®æ”¹ `ruoyi-modules-system` æœåŠ¡

ä¿®æ”¹ä¹‹å‰

```shell
 # æœªä¿®æ”¹ä¹‹å‰
discovery:
        # æœåŠ¡æ³¨å†Œåœ°å€
        server-addr: localhost:8848
      config:
        # é…ç½®ä¸­å¿ƒåœ°å€
        server-addr:  localhost:8848

```


ä¿®æ”¹ä¹‹å

```shell
discovery:
        # æœåŠ¡æ³¨å†Œåœ°å€
        server-addr:  ruoyi-nacos:8848
      config:
        # é…ç½®ä¸­å¿ƒåœ°å€
        server-addr:  ruoyi-nacos:8848

```


![](https://cdn.staticaly.com/gh/wuxin0011/blog-resource@main/picgo/update-host-ip.png)â€‹


å…¶ä»–æœåŠ¡å‚ç…§è¿™ä¸ªæ“ä½œ ä¿®æ”¹ï¼

ä¸€å®šè¦å¯¹åº” `docker-compose.yml` æ–‡ä»¶ä¸­çš„æœåŠ¡å ï¼ï¼ï¼


> æ³¨æ„æ£€æŸ¥ mvn å‘½ä»¤æ˜¯å¦ç”Ÿæ•ˆï¼Œå¦‚æœä¸ç”Ÿæ•ˆè¯·é…ç½®mavenç¯å¢ƒå˜é‡
>


æ¸…é™¤ä¹‹å‰ç¼“å­˜,å¦åˆ™ä¼šå¯¼è‡´ä¿®æ”¹é…ç½®ä¸ç”Ÿæ•ˆ

```shell
.\bin\clean.bat
```


æ‰“åŒ…

```shell
.\bin\clean.bat
```



### 4ã€ä¸Šä¼ åˆ°æœåŠ¡å™¨


å°†ä¹‹å‰æ‰“åŒ…å¥½çš„å„ä¸ªé¡¹ç›®æ‰“åŒ…æ‹·è´åˆ° `docker` ç›®å½•

å¯ä»¥ç›´æ¥ æ‰§è¡Œæ‹·è´è„šæœ¬

```shell
.\docker\copy.sh
```

> **æ³¨æ„**ï¼šå®˜æ–¹ç»™çš„ `copy.sh` è„šæœ¬æ‹·è´å‘½ä»¤å¯èƒ½å¯¼è‡´ä¸€äº›æ–‡ä»¶æ‹·è´ä¸å…¨
>

*  æ£€æŸ¥ sql è„šæœ¬æ˜¯å¦æ‹·è´å®Œå…¨ å‚è€ƒ `sql/*sql`
* æ£€æŸ¥ `docker/nginx/html/dist` ç›®å½•ä¸­æ˜¯å¦å«æœ‰æ–‡ä»¶ å‚è€ƒ `ruoyi-ui/dist` å¦‚æœ IDE ä¸­æ‰¾ä¸åˆ°ï¼Œæ˜¯å› ä¸º IDE ä¸­å±è”½äº†ï¼Œå¯ä»¥åˆ°æœ¬åœ°èµ„æºç®¡ç†å™¨ï¼Œçš„è¯¥ç›®å½•ä¸‹æ‹·è´åˆ°å¯¹åº”æ–‡ä»¶åŠ ä¸­
* æ³¨æ„ `jar`åŒ…æ˜¯å¦æ‰“åŒ…å®Œå…¨åˆ° `/docker/ruoyi/*/jar/` ç›®å½•ä¸‹


ä¸‹é¢ç»™å‡ºå‚è€ƒå›¾

![](https://cdn.staticaly.com/gh/wuxin0011/blog-resource@main/picgo/upload-1.png)â€‹

![](https://cdn.staticaly.com/gh/wuxin0011/blog-resource@main/picgo/upload-2.png)â€‹



å°†é¡¹ç›®ä¸­æ•´ä¸ªdockerç›®å½•ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œä¾‹å¦‚ `/usr/local/project/ruoyi-cloud`

å®Œæ¯•ä¹‹åå°† `docker` æ–‡ä»¶åŠ ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸­ï¼Œæ¥ä¸‹æ¥å°±æ˜¯éƒ¨ç½²äº†





### 5ã€é¡¹ç›®éƒ¨ç½²


#### 1ã€å®‰è£…dockerå’Œdocker-compose

* [å®‰è£… docker](https://docs.docker.com/engine/install/centos/ )
* [å®‰è£…docker-compose](https://docs.docker.com/compose/install/linux)


**è¡¥å……ï¼š**


1ã€æ·»åŠ  docker é•œåƒæº

```shell
vim /etc/docker/daemon.json
```

```vim
{
  "registry-mirrors": ["https://ezs5jiab.mirror.aliyuncs.com"]
}
```


é‡å¯ç”Ÿæ•ˆ

```shell
systemctl daemon-reload
systemctl restart docker
```




  2ã€ å®˜æ–¹ docker-compose å®‰è£…æœ‰ç‚¹æ…¢ï¼Œæ‰§è¡Œè¿™ä¸ªå‘½ä»¤å¯èƒ½å¿«ç‚¹

```shell
curl -SL https://get.daocloud.io/docker/compose/releases/download/v2.16.0/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose
```


ä¸è¦å¿˜äº†å®‰è£…å®Œæ¯•ä¹‹åçµ¦æ–‡ä»¶æ·»åŠ å¯æ‰§è¡Œå‘½ä»¤

```shell
chmod +x /usr/local/bin/docker-compose
```

æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ,è¾“å‡ºå¯¹åº”ç‰ˆæœ¬å·å°±æ˜¯å®‰è£…æˆåŠŸäº†

```shell
docker-compose version
```


#### 2ã€æ¸…ç©ºå®‰è£…ç¯å¢ƒ

> ä¸ºä»€ä¹ˆè¦æ¸…ç©ºä¹‹å‰çš„é•œåƒï¼Ÿ


æœ¬äººå®‰è£…ä¹‹å‰åƒè¿‡äºï¼Œä¹‹å‰å®‰è£…å¤±è´¥æ²¡æœ‰ä¿®æ”¹æœ¬åœ°hostï¼Œå¯¼è‡´éƒ¨ç½²å¤±è´¥ã€‚

ä¿®æ”¹ä¹‹ååœ¨ä¸Šä¼ ï¼Œå¦‚æœä¸åˆ é™¤ä¹‹å‰çš„å®¹å™¨å’Œé•œåƒï¼Œä¼šç»§ç»­éƒ¨ç½²å¤±è´¥ï¼ğŸ˜­

å› ä¸º docker build ä¹‹å‰æ£€æŸ¥æ˜¯å¦æœ‰è¿™ä¸ªé•œåƒ

å¦‚æœæœ‰è¿™ä¸ªé•œåƒä¼šåŸºäºè¿™ä¸ªé•œåƒï¼Œæ„å»ºå®¹å™¨,ç»“æœå½“ç„¶æ˜¯å¤±è´¥äº†ï¼ğŸ¤£

æ²¡æœ‰æ‰ä¼šé‡æ–°æ„å»ºå®¹å™¨


> åˆ é™¤å®¹å™¨

æŸ¥çœ‹æ˜¯å¦æœ‰å®¹å™¨

```shell
docker ps -a
```

å¦‚æœæœ‰å®¹å™¨æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œæ²¡æœ‰å°±ä¸è¦æ‰§è¡Œäº†

```shell
docker rm -f $(docker ps -aq)
```


> åˆ é™¤é•œåƒ



é€šè¿‡`docker images ` æŸ¥çœ‹å·²ç»å®‰è£…çš„é•œåƒ

```shell
docker images
```

**æ³¨æ„ä¸å»ºè®®åˆ é™¤ nacosã€mysqlã€redis,nginxé•œåƒ**

å¦‚ä¸‹åˆ é™¤çº¢æ¡†ä¸­çš„å®¹å™¨

```shell
REPOSITORY                    TAG       IMAGE ID       CREATED         SIZE
docker-ruoyi-modules-system   latest    c755d24e3e7d   4 hours ago     379MB
docker-ruoyi-gateway          latest    8976e5938ec7   4 hours ago     372MB
docker-ruoyi-auth             latest    99f438b7efb7   4 hours ago     364MB
nginx                         latest    605c77e624dd   13 months ago   141MB
redis                         latest    7614ae9453d1   14 months ago   113MB
mysql                         5.7       c20987f18b13   14 months ago   448MB
mysql                         8.0       3218b38490ce   14 months ago   516MB
nacos/nacos-server            latest    bdf60dc2ada3   18 months ago   1.05GB
```

![](https://cdn.staticaly.com/gh/wuxin0011/blog-resource@main/picgo/images1.png)â€‹


é•œåƒåˆ é™¤

```shell
docker rmi -f é•œåƒID
```

ä¾‹å¦‚åˆ é™¤ ä¸‰ä¸ª `ruoyi-gateway` ã€`ruoyi-auth`ã€`ruoyi-modules-system` ä¸‰ä¸ªå®¹å™¨é•œåƒ

```shell
docker rmi -f c755d24e3e7d 8976e5938ec7 99f438b7efb7
```



#### 3 ã€docker-compse æ„å»ºæœåŠ¡


**æ³¨æ„ä»¥ä¸‹å‘½ä»¤éƒ½æ˜¯åœ¨ åˆšåˆšä¸Šä¼ dockeræ–‡ä»¶å¤¹ä¸‹**



```shell
-bash-4.2# ls
copy.sh  deploy.sh  docker-compose.yml  mysql  nacos  nginx  redis  ruoyi
-bash-4.2# pwd
/root/docker
```


<br />


**1ã€å¯åŠ¨ åŸºç¡€æœåŠ¡**

* MySQLæœåŠ¡
* Redis  æœåŠ¡
* Nacos æœåŠ¡

```shell
docker-compose up -d ruoyi-mysql ruoyi-redis ruoyi-nacos
```

ä¸è¦æ€¥äºå¼€å¯å…¶ä»–æœåŠ¡ï¼ŒæœåŠ¡å¼€å¯åæ£€æŸ¥ MySQL ä¸­æ˜¯å¦æ‰§è¡Œäº† sql è„šæœ¬

ä¹Ÿå¯ä»¥é€šè¿‡ mysql å¯è§†åŒ–å·¥å…·æ“ä½œ,**å¦‚æœæ²¡æœ‰å¯¹åº”æ•°æ®åº“ï¼Œå¯å¯¼å…¥ä¹‹å‰çš„ sql è„šæœ¬**

![](https://cdn.staticaly.com/gh/wuxin0011/blog-resource@main/picgo/mysql.png)â€‹


å¦‚æœæ²¡æœ‰å¯è§†åŒ–å·¥å…·ï¼Œå¯é€šè¿‡å®¹å™¨å‘½ä»¤è¿›å…¥æ•°æ®åº“å®¹å™¨æ“ä½œå®‰è£…è„šæœ¬

```shell
docker exec  -it ruoyi-mysql mysql -uroot -ppassword
```

```shell
create datebase ry-config if not exist charset uft8
source /tmp/*sql
exit
exit

```



**æ•°æ®åº“æ²¡é—®é¢˜ä¹‹åæ£€æŸ¥ nacos æœåŠ¡æ˜¯å¦å¯ç”¨**

```shell
docker-compose logs -f ruoyi-nacos
```


![](https://cdn.staticaly.com/gh/wuxin0011/blog-resource@main/picgo/nacos1.png)â€‹


**æ³¨æ„ï¼šå¦‚æœæœåŠ¡æŠ¥é”™ xxx NoDataSource xxx ä¹‹ç±»é”™è¯¯ï¼Œå¤§æ¦‚ç‡æ˜¯æ•°æ®åº“æ²¡æœ‰å¯¹åº”è¡¨æˆ–è€…æ•°æ®åº“è¿æ¥ä¸ä¸Š**

ä¾‹å¦‚

```log
Caused by: java.lang.IllegalStateException: No DataSource set
	at org.springframework.util.Assert.state(Assert.java:73)
	at org.springframework.jdbc.support.JdbcAccessor.obtainDataSource(JdbcAccessor.java:77)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:371)
	at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:452)
	at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:462)
	at org.springframework.jdbc.core.JdbcTemplate.queryForObject(JdbcTemplate.java:473)
	at org.springframework.jdbc.core.JdbcTemplate.queryForObject(JdbcTemplate.java:480)
	at com.alibaba.nacos.config.server.service.repository.extrnal.ExternalStoragePersistServiceImpl.findConfigMaxId(ExternalStoragePersistServiceImpl.java:658)
	at com.alibaba.nacos.config.server.service.dump.processor.DumpAllProcessor.process(DumpAllProcessor.java:51)
	at com.alibaba.nacos.config.server.service.dump.DumpService.dumpConfigInfo(DumpService.java:293)
	at com.alibaba.nacos.config.server.service.dump.DumpService.dumpOperate(DumpService.java:205)
	... 61 common frames omitted

```

æ­¤ä¸ºæ•°æ®åº“è¿æ¥ä¸ä¸Šï¼æ•°æ®åº“æ²¡é—®é¢˜ï¼Œé‚£ä¹ˆé‡å¯è¿™ä¸ªæœåŠ¡

```shell
docker-compose restart ruoyi-nacos
```


å¯åœ¨æµè§ˆå™¨ä¸­æ£€æŸ¥æ˜¯å¦å¯ç”¨ http://192.168.233.40:8848/nacos/

![](https://cdn.staticaly.com/gh/wuxin0011/blog-resource@main/picgo/nacos2.png)â€‹


ç„¶åå°±æ˜¯æŒ‰ç…§ä¸Šå›¾æ‰€ç¤ºä¿®æ”¹å„ä¸ªæœåŠ¡çš„é…ç½®æ–‡ä»¶ï¼Œä¸»è¦æœ‰

* è¿æ¥ mysql çš„å°† localhost:3360 ,ä¿®æ”¹ä¸º `mysqlæœåŠ¡å:port` ä¾‹å¦‚ `ruoyi-mysql:3306`

  æ³¨æ„: å¦‚æœä¸å°† è¿æ¥åœ°å€URL çš„
* redis åŒ ä¸Šé¢ mysql æœåŠ¡ï¼Œå°†è¿æ¥redisçš„ï¼Œä¿®æ”¹ä¸º `ruoyi-redis`
* å…¶ä»–æœåŠ¡åŒç†


ä¿®æ”¹ redis è¿æ¥

![](https://cdn.staticaly.com/gh/wuxin0011/blog-resource@main/picgo/nacos-redis.png)â€‹

ä¿®æ”¹ mysql è¿æ¥


![](https://cdn.staticaly.com/gh/wuxin0011/blog-resource@main/picgo/nacos-mysql.png)â€‹



ä¿®æ”¹ mysql  `useSSL=false`

![](https://cdn.staticaly.com/gh/wuxin0011/blog-resource@main/picgo/mysql-useSSL.png)â€‹





**2ã€å¯åŠ¨** 

* ç½‘å…³æœåŠ¡
* éªŒè¯æœåŠ¡
* æ ¸å¿ƒæœåŠ¡

```shell
docker-compose up -d ruoyi-nginx ruoyi-gateway ruoyi-auth ruoyi-modules-system
```


æ£€æŸ¥æ˜¯å¦èƒ½å¤Ÿè¿æ¥æœåŠ¡ http://192.168.233.40:80/


![](https://cdn.staticaly.com/gh/wuxin0011/blog-resource@main/picgo/ruoyi-ui-2.png)



åå°

![](https://cdn.staticaly.com/gh/wuxin0011/blog-resource@main/picgo/ruoyi-ui-3.png)â€‹


æ³¨æ„:å¦‚æœè·å–å¤±è´¥ æŠ¥é”™ 404 æˆ–è€…å…¶ä»–é”™è¯¯ï¼Œä¸€å®šè¦è€å¿ƒç­‰å¾…ï¼é…ç½®ç”Ÿæ•ˆæœ‰ç‚¹æ…¢

æ˜¯åœ¨ä¸è¡Œé‡å¯æœåŠ¡

```shell
docker-compose start ruoyi-gateway ruoyi-auth ruoyi-modules-system
```



3ã€å¯åŠ¨æ¬¡è¦æœåŠ¡ (ç”±äºæµ‹è¯•ï¼Œå’Œè™šæ‹Ÿæœºå®¹é‡é—®é¢˜ï¼Œè¿™ä¸ªæ­¥éª¤å°±ä¸æ“ä½œäº†,ä¸‹é¢ç»™å‡ºæ“ä½œï¼Œä¸æˆªå›¾äº†)

* ä»£ç ç”Ÿæˆå™¨
* ä»»åŠ¡è°ƒåº¦
* æ–‡ä»¶æœåŠ¡
* ç³»ç»Ÿç›‘è§†

```shell
docker-compose up -d ruoyi-modules-gen ruoyi-modules-job ruoyi-modules-file ruoyi-visual-monitor
```




ğŸ§¡4ã€ä¸€æ¬¡æ€§å¼€å¯æ‰€æœ‰æœåŠ¡ï¼Œä¸å»ºè®®ä¸€æ¬¡æ€§å¼€å¯è¿™ä¹ˆå¤šæœåŠ¡ï¼Œå¯¹å¯¹æœåŠ¡å™¨æœ‰ä¸€å®šå‹åŠ›ï¼ï¼ï¼

```shell
docker-compose up -d
```

### 4ã€ç»“æŸ

å°±åˆ°è¿™é‡Œå§ï¼
åšå®¢å›­åœ°å€: [https://www.cnblogs.com/wuxin001/p/17124437.html](https://www.cnblogs.com/wuxin001/p/17124437.html)



